+++
author = "Rintaro Sekino"
title = "ミクシィさんの「約6年間運用したシステムをKubernetesに完全移行するまで」を読んで"
date = "2022-07-18"
description = "対外発表からのインプットを自分なりの解釈をしてアウトプットしています"
tags = [
    "対外発表",
    "インプット",
]
+++
# 発表元
[Kubernetes Meetup Novice](https://k8s-novice-jp.connpass.com/)というイベントの第20回にて発表された[約6年間運用したシステムをKubernetesに完全移行するまで/Kubernetes Novice Tokyo](https://speakerdeck.com/isaoshimizu/kubernetes-novice-tokyo)という記事になります。SREグループのマネージャーさんが発表しており、コンテナベースのオーケストレーター（Kubernetes）へのマイグレーション及びAWSの事例として興味深い内容だったので読みたい！と感じた記事でした。

# 概要
- オンプレミスからのマイグレーションではなく、AWS EC2からコンテナベースのワークロードへのマイグレーション事例
  - 私自身、オンプレミスからのマイグレーション経験はあるがEC2等のある程度低コストでメンテナンス可能なVMからコンテナへのマイグレーションの経験はありませんでした。
  - 解決したい問題の中で最も同意できたのは**アプリケーションを「イミュータブル」に扱うことで解決できる課題**の点でした。
  - 一方で、一時的にスパイクするトラフィックを**オートスケール等で解くのはコンテナでもある程度の練度が求められそう**と感じました。
- AWSのエコシステムの中でアーキテクチャを組みたいという背景
  - システム基盤選定でAWSがよく選定されており、上手にロックインしていると感じていましたが、実際に他社が**どのようなモチベーションでAWSを選定し続けるか**を知ることができました。
  - **ECS vs EKS**のような議論はどのIaaSを利用するときも登場するので選定理由の事例が出るのは良いことだと感じます。
    - Kubernetes自体をどの程度運用したいか、細かなオペレーションが要求されるかというのがよく登場する論点かと思います。
- 実際にシステムの基盤として運用する際の懸念事項を洗い出している
  - 目をつけている点が実際に何年も運用してきたという経験がにじみ出ていると感じました。
    - 特に最初に**シークレットの扱い**が出てくる辺りがとても素敵でした。
    - また、**DBマイグレーションについても言及されておりイミュータブルなワークロードで苦労する点**を押さえていると感じました。
    - バージョンアップ時にEKSを使い捨てるという選択（感覚）もパブリッククラウドの利用経験が豊富だと感じました。
- マイグレーションフローについて
  - Terraformを用いて構成管理しているのはとても好感が持てました
    - **Workspacesを利用しているとのことで、これを上手に運用できるかが今後のポイント**だなと感じました。
      - 私は一度Workspacesの利用に挑戦しましたが、Dev,Stg,Prodにおける差分をWorkspacesで綺麗に扱えませんでした。（プロジェクト次第なところもある）

# 学んだこと、感じたこと
- ミクシィさんにはサービスを設計、運用する人的リソースやノウハウが蓄積されていることが伝わりました。
  - シークレット周りで、**VaultではなくExternal Secretを選定できる**辺りにIaaS利用の練度を感じます。
  - メトリクスの計測にも言及しており、自前の計測システムに拘るよりか、AWSのエコシステムを使い倒す方針を感じる。
- AWSを利用しているユーザがどのような観点で次期のシステム基盤を選定するか。
  - **データをどこに置いているか**、が大切な点として理解しました。
  - つまり**データストアとして優秀であれば、ワークロードも取れる可能性が高い**。
